let isRequestInProgress=!1,loteriaAtual="megasena",carregandoResultados=!1,artigosVisiveis=5,graficos={maisSorteados:null,menosSorteados:null,primos:null,paresImpares:null,maisSorteadosRecentes:null,menosSorteadosRecentes:null};const lotteryConfig={megasena:{nome:"Mega-Sena",min_dezenas:6,max_dezenas:20,num_bolas:6,universo:60,default_dezenas:6},quina:{nome:"Quina",min_dezenas:5,max_dezenas:15,num_bolas:5,universo:80,default_dezenas:5},lotofacil:{nome:"Lotof\xe1cil",min_dezenas:15,max_dezenas:20,num_bolas:15,universo:25,default_dezenas:15},diadesorte:{nome:"Dia de Sorte",min_dezenas:7,max_dezenas:15,num_bolas:7,universo:31,default_dezenas:7},duplasena:{nome:"Dupla Sena",min_dezenas:6,max_dezenas:15,num_bolas:6,universo:50,default_dezenas:6},lotomania:{nome:"Lotomania",min_dezenas:50,max_dezenas:50,num_bolas:20,universo:100,default_dezenas:50}},totalArtigos=10,cooldownTimes={montecarlo:10},meses=["Janeiro","Fevereiro","Mar\xe7o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];function getElement(e){return document.getElementById(e)}function getElements(e){return document.querySelectorAll(e)}function copiarNumeros(e){let a=e.closest(".jogo"),t="";(t=a?[...a.querySelectorAll(".numero")].map(e=>e.textContent).join(" "):e.getAttribute("data-copy-text"))&&navigator.clipboard.writeText(t).then(()=>{mostrarFeedbackCopia(e)}).catch(e=>{console.error("Falha ao copiar:",e),alert("Falha ao copiar. Por favor, copie manualmente: "+t)})}function mostrarFeedbackCopia(e){let a=e.innerHTML,t=e.style.background;e.innerHTML='<i class="fa-solid fa-check"></i>',e.closest(".jogo")||(e.innerHTML+=" Copiado!",e.style.background="var(--cor-sucesso)"),setTimeout(()=>{e.innerHTML=a,t?e.style.background=t:e.style.removeProperty("background")},2e3)}function setGeradorEstado(e){isRequestInProgress=e;let a=getElement("botao-gerar-principal");a&&(a.disabled=e),getElements(".seletor-custom, #numeros-ancora").forEach(a=>{a.disabled=e})}function mudarLoteria(e){loteriaAtual=e;let a=lotteryConfig[loteriaAtual],t=getElement("loteria-selecionada");t&&(t.textContent=a.nome,t.style.opacity=1);let r=getElement("loteria-select-resultados");r&&(r.value=e);let o=getElement("nome-loteria-resultados");o&&(o.textContent=a.nome),atualizarOpcoesDezenas(),atualizarOpcoesQuantidade(),handleEstrategiaChange(),limparResultadosAnteriores(),carregarUltimosResultados(e)}function mudarLoteriaResultados(e){let a=lotteryConfig[e],t=getElement("nome-loteria-resultados");t&&(t.textContent=a.nome),carregarUltimosResultados(e)}function limparResultadosAnteriores(){let e=getElement("area-resultados");e&&(e.innerHTML="");let a=getElement("area-estatisticas");a&&(a.style.display="none");let t=document.querySelector("#estatisticas .botao-gerar");t&&(t.style.display="block",t.disabled=!1,t.innerHTML="Estat\xedsticas")}function atualizarOpcoesDezenas(){let e=getElement("dezenas-select");if(!e)return;let a=lotteryConfig[loteriaAtual];e.innerHTML="";for(let t=a.min_dezenas;t<=a.max_dezenas;t++){let r=document.createElement("option");r.value=t,r.textContent=`${t} Dezenas`,e.appendChild(r)}}function atualizarOpcoesQuantidade(){let e=getElement("quantidade-select");if(e){e.innerHTML="";for(let a=1;a<=10;a++){let t=document.createElement("option");t.value=a,t.textContent=`${String(a).padStart(2,"0")} ${a>1?"Jogos":"Jogo"}`,e.appendChild(t)}}}function handleEstrategiaChange(){let e={estrategia:getElement("estrategia-select"),dezenas:getElement("dezenas-select"),quantidade:getElement("quantidade-select"),ancora:getElement("numeros-ancora")};if(!e.estrategia)return;let a=e.estrategia.value,t=lotteryConfig[loteriaAtual],r="montecarlo"===a;r&&(e.dezenas.value=t.num_bolas,e.quantidade.value=1,e.ancora.value=""),Object.values(e).slice(1).forEach(e=>{e.disabled=r})}async function gerarPalpites(){if(isRequestInProgress)return;let e={resultados:getElement("area-resultados"),estrategia:getElement("estrategia-select"),dezenas:getElement("dezenas-select"),quantidade:getElement("quantidade-select"),ancora:getElement("numeros-ancora")};if(!e.resultados||!e.estrategia)return;let a={estrategia:e.estrategia.value,dezenas:e.dezenas.value,quantidade:e.quantidade.value,ancora:e.ancora.value};setGeradorEstado(!0),e.resultados.innerHTML='<div class="spinner"></div>';try{let t=construirURL(a),r=await fetch(t);if(!r.ok)throw Error(`Erro na comunica\xe7\xe3o: ${r.statusText}`);let o=await r.json();if(o.error)throw Error(`Erro no servidor: ${o.error}`);let s="montecarlo"===a.estrategia?[o.jogo]:o;renderizarJogos(s,e.resultados)}catch(n){console.error("Erro ao gerar palpites:",n),e.resultados.innerHTML=`<p style="color: #ff8a80;">Falha na conex\xe3o. Tente novamente em alguns segundos.</p>`}finally{aplicarCooldown(a.estrategia)}}function construirURL(e){let{estrategia:a,quantidade:t,dezenas:r,ancora:o}=e;return"montecarlo"===a?`/get-monte-carlo-game?loteria=${loteriaAtual}&ancora=${o}`:`/get-games/${t}?loteria=${loteriaAtual}&estrategia=${a}&dezenas=${r}&ancora=${o}`}function aplicarCooldown(e){let a=cooldownTimes[e];if(!a){setGeradorEstado(!1),handleEstrategiaChange();return}let t=getElement("botao-gerar-principal");if(!t)return;let r=a;t.innerHTML=`Aguarde ${r}s...`;let o=setInterval(()=>{--r>0?t.innerHTML=`Aguarde ${r}s...`:(clearInterval(o),t.innerHTML="Gerar Palpites",setGeradorEstado(!1),handleEstrategiaChange())},1e3)}function renderizarJogos(e,a){a&&(a.innerHTML="<h2>Boa sorte!</h2>",e.forEach(e=>{let t=criarElementoJogo(e);a.appendChild(t)}),adicionarInstrucaoAposta(a))}function criarElementoJogo(e){let a=document.createElement("div");a.className="jogo";let t=document.createElement("div");t.className="numeros-container";let r=e.trim().split(/\s+/);if("duplasena"===loteriaAtual&&12===r.length){let o=r.slice(0,6),s=r.slice(6,12),n=document.createElement("div");n.className="sorteio-header",n.textContent="1\xba Sorteio:",t.appendChild(n),o.forEach(e=>{let a=document.createElement("span");a.className="numero",a.textContent=e,t.appendChild(a)});let i=document.createElement("div");i.className="sorteio-header",i.textContent="2\xba Sorteio:",t.appendChild(i),s.forEach(e=>{let a=document.createElement("span");a.className="numero",a.textContent=e,t.appendChild(a)})}else{let l=[...r].sort((e,a)=>e-a);l.forEach(e=>{let a=document.createElement("span");a.className="numero",a.textContent=e,t.appendChild(a)})}return"diadesorte"===loteriaAtual&&t.appendChild(criarMesSorte()),a.appendChild(t),a.appendChild(criarBotaoCopiar()),a}function criarNumeroSpan(e){let a=document.createElement("span");return a.className="numero",a.textContent=e,a}function criarHeaderSorteio(e){let a=document.createElement("div");return a.className="sorteio-header",a.textContent=e,a}function criarMesSorte(){let e=meses[Math.floor(Math.random()*meses.length)],a=document.createElement("span");return a.textContent=`| M\xeas: ${e}`,a.style.cssText="font-weight:bold; margin-left:15px; font-size: 1.2rem;",a}function criarBotaoCopiar(){let e=document.createElement("button");return e.className="botao-copiar",e.innerHTML='<i class="fa-regular fa-copy"></i>',e.title="Copiar n\xfameros",e.onclick=()=>copiarNumeros(e),e}function adicionarInstrucaoAposta(e){let a=document.createElement("p");a.className="instrucao-aposta",a.textContent="Caso queira concorrer com os n\xfameros gerados no site, voc\xea precisa registr\xe1-los em uma aposta oficial, em qualquer ag\xeancia lot\xe9rica ou no site de apostas da Caixa Econ\xf4mica Federal\xae, por sua conta e riscos. Boa sorte!",e.appendChild(a)}async function carregarChart(){window.Chart||await import("https://cdn.jsdelivr.net/npm/chart.js")}async function exibirEstatisticas(){let e=document.querySelector("#estatisticas .botao-gerar");if(!isRequestInProgress&&e&&!e.disabled){await carregarChart(),isRequestInProgress=!0,e.disabled=!0,e.innerHTML='<div class="spinner" style="width: 25px; height: 25px; margin: 0 auto;"></div> Carregando...';try{let a=await buscarDadosEstatisticas();atualizarInfoEstatisticas(a.gerais),criarTodosGraficos(a);let t=getElement("area-estatisticas");t&&(t.style.display="block"),e.style.display="none"}catch(r){console.error("Erro ao carregar estat\xedsticas:",r),mostrarErroEstatisticas(r.message),e.innerHTML="Estat\xedsticas",e.disabled=!1}finally{isRequestInProgress=!1}}}async function buscarDadosEstatisticas(){try{let[e,a]=await Promise.all([fetch(`/get-stats?loteria=${loteriaAtual}`),fetch(`/get-stats-recentes?loteria=${loteriaAtual}`)]);if(!e.ok)throw Error(`Erro ${e.status}: ${e.statusText}`);if(!a.ok)throw Error(`Erro ${a.status}: ${a.statusText}`);let t=await e.json(),r=await a.json();if(t.error)throw Error(`Backend: ${t.error}`);if(r.error)throw Error(`Backend: ${r.error}`);if(!t.frequencia||!Array.isArray(t.frequencia))throw Error("Dados de frequ\xeancia inv\xe1lidos recebidos do servidor.");if(!r.frequencia_recente||!Array.isArray(r.frequencia_recente))throw Error("Dados de frequ\xeancia recente inv\xe1lidos recebidos do servidor.");return{gerais:t,recentes:r}}catch(o){throw console.error("Erro detalhado ao buscar estat\xedsticas:",o),Error(`Falha na comunica\xe7\xe3o com o servidor: ${o.message}`)}}function atualizarInfoEstatisticas(e){let a=lotteryConfig[loteriaAtual].nome,t=getElement("ultimo-concurso-info");t&&(t.innerHTML=`An\xe1lise da ${a}: at\xe9 o concurso ${e.ultimo_concurso}`)}function criarTodosGraficos(e){Object.values(graficos).forEach(e=>{e&&e.destroy()});let a={scales:{y:{ticks:{color:"#FFFDE7"},grid:{color:"rgba(255, 255, 255, 0.2)"}},x:{ticks:{color:"#FFFDE7"},grid:{color:"transparent"}}},plugins:{legend:{labels:{color:"#FFFDE7"},onClick:null}}};graficos.maisSorteados=criarGrafico("grafico-mais-sorteados",e.gerais.frequencia,"desc","Vezes Sorteado","#FFD700",a),graficos.menosSorteados=criarGrafico("grafico-menos-sorteados",e.gerais.frequencia,"asc","Vezes Sorteado","#90CAF9",a),graficos.maisSorteadosRecentes=criarGrafico("grafico-mais-sorteados-recentes",e.recentes.frequencia_recente,"desc","Vezes Sorteado (\xdaltimos 100)","#FFECB3",a),graficos.menosSorteadosRecentes=criarGrafico("grafico-menos-sorteados-recentes",e.recentes.frequencia_recente,"asc","Vezes Sorteado (\xdaltimos 100)","#BBDEFB",a),graficos.primos=criarGraficoPrimos(e.gerais.stats_primos,a),graficos.paresImpares=criarGraficoParesImpares(e.gerais.stats_pares,a)}function criarGrafico(e,a,t,r,o,s){let n=getElement(e);if(!n)return null;let i=[...a].sort((e,a)=>"desc"===t?a.frequencia-e.frequencia:e.frequencia-a.frequencia).slice(0,10);return new Chart(n.getContext("2d"),{type:"bar",data:{labels:i.map(e=>`N\xba ${e.numero}`),datasets:[{label:r,data:i.map(e=>e.frequencia),backgroundColor:o}]},options:s})}function criarGraficoPrimos(e,a){let t=getElement("grafico-primos");if(!t)return null;let r=Object.keys(e).sort((e,a)=>parseInt(e)-parseInt(a)).map(e=>`${e} Primos`),o=Object.keys(e).sort((e,a)=>parseInt(e)-parseInt(a)).map(a=>e[a]);return new Chart(t.getContext("2d"),{type:"bar",data:{labels:r,datasets:[{label:"Sorteios",data:o,backgroundColor:"#81C784"}]},options:a})}function criarGraficoParesImpares(e,a){let t=getElement("grafico-pares-impares");if(!t)return null;let r=lotteryConfig[loteriaAtual].num_bolas,o=Object.keys(e).sort((e,a)=>parseInt(e)-parseInt(a)).map(e=>`${e} Pares / ${r-parseInt(e)} \xcdmpares`),s=Object.keys(e).sort((e,a)=>parseInt(e)-parseInt(a)).map(a=>e[a]);return new Chart(t.getContext("2d"),{type:"bar",data:{labels:o,datasets:[{label:"Sorteios",data:s,backgroundColor:"#FF8A65"}]},options:a})}function mostrarErroEstatisticas(e){let a=getElement("area-estatisticas");a&&(a.innerHTML=`<p style="color: #ff8a80;">${e}</p>`,a.style.display="block")}async function carregarUltimosResultados(e){if(carregandoResultados)return;carregandoResultados=!0;let a=getElement("lista-ultimos-resultados");if(!a){carregandoResultados=!1;return}a.innerHTML='<div class="spinner"></div>';try{let t=await fetch(`/get-ultimos-resultados?loteria=${e}`);if(!t.ok)throw Error("Falha ao carregar os resultados.");let r=await t.json();if(r.error)throw Error(r.error);if(0===r.length){a.innerHTML="<p>Nenhum resultado encontrado para esta loteria.</p>";return}a.innerHTML=r.map(a=>criarHtmlResultado(a,e)).join("")}catch(o){console.error("Erro ao carregar \xfaltimos resultados:",o),a.innerHTML=`<p style="color: #ff8a80;">N\xe3o foi poss\xedvel carregar os resultados. Tente novamente mais tarde.</p>`}finally{carregandoResultados=!1}}function criarHtmlResultado(e,a){let t=criarStatusHtml(e),r=criarMesHtml(e,a),o=formatarData(e.data),s=`<div class="resultado-dezenas">${e.dezenas}</div>`;if("duplasena"===a&&e.dezenas){let n=e.dezenas.split(" ");if(12===n.length){let i=n.slice(0,6),l=n.slice(6,12);s=`
                <div class="duplasena-sorteios">
                    <div class="sorteio-header">1\xba Sorteio:</div>
                    <div class="resultado-dezenas">${i.join(" ")}</div>
                    <div class="sorteio-header">2\xba Sorteio:</div>
                    <div class="resultado-dezenas">${l.join(" ")}</div>
                </div>
            `}else s=`<div class="resultado-dezenas">${e.dezenas}</div>`}return`
        <div class="resultado-item">
            <div class="resultado-header">
                <span class="resultado-concurso">Concurso ${e.concurso}</span>
                <span class="resultado-data">${o}</span>
            </div>
            ${s}
            ${r}
            <div class="resultado-status">${t}</div>
        </div>
    `}function criarStatusHtml(e){if(e.acumulou){let a='<span class="status-acumulou">ACUMULOU</span>';return e.valor_acumulado&&(a+=`<div class="valor-acumulado">Pr\xeamio estimado: R$ ${e.valor_acumulado.toLocaleString("pt-BR",{minimumFractionDigits:2})}</div>`),a}let t=e.ganhadores>1?"Ganhadores":"Ganhador";return`<span class="status-ganhador">${e.ganhadores} ${t}</span>`}function criarMesHtml(e,a){return"diadesorte"===a&&e.mes_sorte?`<div class="resultado-mes">M\xeas da Sorte: <strong>${e.mes_sorte}</strong></div>`:""}function formatarData(e){if(!e||!e.includes("/"))return e||"";let a=e.split("/");if(3!==a.length)return e;let[t,r,o]=a.map(e=>parseInt(e));return t>12?e:r>12?`${a[1]}/${a[0]}/${a[2]}`:e}async function submitFeedback(e){let a=getElement("feedback-area"),t=getElement("feedback-message");if(a&&t)try{let r=await fetch("/submit-feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({choice:e})});if(!r.ok)throw Error("Falha ao enviar.");t.textContent="Obrigado pelo seu feedback!",t.style.color="#81C784",a.querySelectorAll("button").forEach(e=>{e.disabled=!0})}catch(o){t.textContent="Erro ao enviar. Tente novamente.",t.style.color="#ff8a80"}}function carregarMaisArtigos(){let e=getElements(".artigo-blog:not(.visivel)"),a=Math.min(4,e.length);for(let t=0;t<a;t++)e[t].classList.add("visivel"),artigosVisiveis++;atualizarContadorArtigos(),e.length>0&&e[0].scrollIntoView({behavior:"smooth",block:"center"})}function atualizarContadorArtigos(){let e=getElement("contador-artigos");e&&(e.textContent=`Mostrando ${artigosVisiveis} de 10 artigos`);let a=document.querySelector(".carregar-mais"),t=document.querySelector(".carregar-mais-container p");artigosVisiveis>=10&&(a&&(a.style.display="none"),t&&(t.innerHTML='<span style="color: var(--cor-sucesso);">✓ Todos os artigos carregados!</span>'))}function toggleArtigo(e){let a=getElement(e);if(!a)return;let t=a.closest(".artigo-blog"),r=t.querySelector(".artigo-resumo"),o=t.querySelector(".fa-chevron-down, .fa-chevron-up"),s=a.classList.contains("artigo-expandido");a.classList.toggle("artigo-expandido",!s),r&&(r.style.display=s?"block":"none"),o&&(o.classList.toggle("fa-chevron-up",!s),o.classList.toggle("fa-chevron-down",s))}const compartilhamento={whatsapp(e,a){let t=encodeURIComponent(`${e} - ${a}`);window.open(`https://wa.me/?text=${t}`,"_blank")},facebook(e){window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(e)}`,"_blank")},twitter(e,a){let t=encodeURIComponent(`${e} ${a}`);window.open(`https://twitter.com/intent/tweet?text=${t}`,"_blank")},threads(e,a){let t=encodeURIComponent(`${e} ${a}`);window.open(`https://www.threads.net/intent/post?text=${t}`,"_blank")},instagram(){confirm("Para compartilhar no Instagram:\n\n1. Abra o Instagram\n2. Crie uma nova publica\xe7\xe3o ou story\n3. Marque @sorteanalisadaoficial\n4. Use a hashtag #SorteAnalisada\n\nDeseja abrir o Instagram?")&&window.open("https://www.instagram.com/sorteanalisadaoficial?igsh=cW8zenNycWVieXF1","_blank")},tiktok(){confirm("Para compartilhar no TikTok:\n\n1. Abra o TikTok\n2. Crie um v\xeddeo mencionando a Sorte Analisada\n3. Use a hashtag #SorteAnalisada\n4. Marque @sorteanalisadaoficial\n\nDeseja abrir o TikTok?")&&window.open("https://www.tiktok.com/","_blank")}};function compartilharWhatsApp(e,a){compartilhamento.whatsapp(e,a)}function compartilharFacebook(e){compartilhamento.facebook(e)}function compartilharTwitter(e,a){compartilhamento.twitter(e,a)}function compartilharThreads(e,a){compartilhamento.threads(e,a)}function compartilharInstagram(){compartilhamento.instagram()}function compartilharTikTok(){compartilhamento.tiktok()}function copiarLink(e,a){navigator.clipboard.writeText(e).then(()=>{let e=a?.target?.closest(".share-btn");if(e){let t=e.innerHTML;e.innerHTML='<i class="fa-solid fa-check"></i> Copiado!',e.style.background="var(--cor-sucesso)",setTimeout(()=>{e.innerHTML=t,e.style.background="#6c757d"},2e3)}}).catch(a=>{console.error("Falha ao copiar:",a);let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy"),alert("Link copiado!")}catch(r){alert("Falha ao copiar. Por favor, copie manualmente: "+e)}document.body.removeChild(t)})}function carregarFooter(){let e=getElement("footer");e&&fetch("/static/partials/footer.html").then(e=>e.text()).then(a=>{e.innerHTML=a}).catch(e=>console.error("Erro ao carregar rodap\xe9:",e))}function configurarEventListeners(){let e=getElement("loteria-select");if(e){mudarLoteria(loteriaAtual=e.value),e.addEventListener("change",()=>mudarLoteria(e.value));let a=getElement("loteria-select-resultados");a&&a.addEventListener("change",()=>{mudarLoteriaResultados(a.value)});let t=getElement("estrategia-select");t&&t.addEventListener("change",handleEstrategiaChange);let r=getElement("botao-gerar-principal");r&&r.addEventListener("click",gerarPalpites);let o=document.querySelector("#estatisticas .botao-gerar");o&&o.addEventListener("click",exibirEstatisticas)}}function configurarEventListenersBlog(){let e=getElement("contador-artigos");if(e){e.textContent=`Mostrando ${artigosVisiveis} de 10 artigos`;let a=document.querySelector(".carregar-mais");a&&a.addEventListener("click",carregarMaisArtigos),getElements(".artigo-blog").forEach((e,a)=>{a<artigosVisiveis&&e.classList.add("visivel")})}}function configurarEventListenersCompartilhamento(){getElements(".share-btn.copy-link").forEach(e=>{e.addEventListener("click",function(a){let t=e.dataset.url||window.location.href;copiarLink(t,a)})})}document.addEventListener("DOMContentLoaded",function(){carregarFooter(),configurarEventListeners(),configurarEventListenersBlog(),configurarEventListenersCompartilhamento()});