let isRequestInProgress=!1;function copiarNumeros(e){let a=e.closest(".jogo");if(!a){let t=e.getAttribute("data-copy-text");if(t){navigator.clipboard.writeText(t).then(()=>{let a=e.innerHTML;e.innerHTML='<i class="fa-solid fa-check"></i> Copiado!',e.style.background="var(--cor-sucesso)",setTimeout(()=>{e.innerHTML=a,e.style.removeProperty("background")},2e3)}).catch(e=>{console.error("Falha ao copiar:",e),alert("Falha ao copiar. Por favor, copie manualmente: "+t)});return}}let o=[...a.querySelectorAll(".numero")].map(e=>e.textContent).join(" ");navigator.clipboard.writeText(o).then(()=>{let a=e.innerHTML;e.innerHTML='<i class="fa-solid fa-check"></i>',setTimeout(()=>{e.innerHTML=a},2e3)}).catch(e=>{console.error("Falha ao copiar n\xfameros: ",e)})}document.getElementById("footer")&&fetch("/static/partials/footer.html").then(e=>e.text()).then(e=>{document.getElementById("footer").innerHTML=e}).catch(e=>console.error("Erro ao carregar rodap\xe9:",e));let loteriaAtual="megasena";const lotteryConfig={megasena:{nome:"Mega-Sena",min_dezenas:6,max_dezenas:20,num_bolas:6,universo:60},quina:{nome:"Quina",min_dezenas:5,max_dezenas:15,num_bolas:5,universo:80},lotofacil:{nome:"Lotof\xe1cil",min_dezenas:15,max_dezenas:20,num_bolas:15,universo:25},diadesorte:{nome:"Dia de Sorte",min_dezenas:7,max_dezenas:15,num_bolas:7,universo:31}};let graficoMaisSorteados=null,graficoMenosSorteados=null,graficoPrimos=null,graficoParesImpares=null,graficoMaisSorteadosRecentes=null,graficoMenosSorteadosRecentes=null,carregandoResultados=!1;function mudarLoteria(e){loteriaAtual=e;let a=lotteryConfig[loteriaAtual],t=document.getElementById("loteria-selecionada");t&&(t.textContent=a.nome,t.style.opacity=1);let o=document.getElementById("loteria-select-resultados");o&&(o.value=e);let r=document.getElementById("nome-loteria-resultados");r&&(r.textContent=a.nome),atualizarOpcoesDezenas(),atualizarOpcoesQuantidade(),handleEstrategiaChange();let s=document.getElementById("area-resultados");s&&(s.innerHTML="");let n=document.getElementById("area-estatisticas");n&&(n.style.display="none");let i=document.querySelector("#estatisticas .botao-gerar");i&&(i.style.display="block",i.disabled=!1,i.innerHTML="Estat\xedsticas"),carregarUltimosResultados(e)}function mudarLoteriaResultados(e){let a=lotteryConfig[e],t=document.getElementById("nome-loteria-resultados");t&&(t.textContent=a.nome),carregarUltimosResultados(e)}function atualizarOpcoesDezenas(){let e=document.getElementById("dezenas-select");if(!e)return;let a=lotteryConfig[loteriaAtual];e.innerHTML="";for(let t=a.min_dezenas;t<=a.max_dezenas;t++){let o=document.createElement("option");o.value=t,o.textContent=`${t} Dezenas`,e.appendChild(o)}}function atualizarOpcoesQuantidade(){let e=document.getElementById("quantidade-select");if(e){e.innerHTML="";for(let a=1;a<=10;a++){let t=document.createElement("option");t.value=a,t.textContent=`${String(a).padStart(2,"0")} ${a>1?"Jogos":"Jogo"}`,e.appendChild(t)}}}function handleEstrategiaChange(){let e=document.getElementById("estrategia-select"),a=document.getElementById("dezenas-select"),t=document.getElementById("quantidade-select"),o=document.getElementById("numeros-ancora");if(!e||!a||!t||!o)return;let r=e.value,s=lotteryConfig[loteriaAtual];"montecarlo"===r||"sorteanalisadapremium"===r?(a.value=s.num_bolas,a.disabled=!0,t.value=1,t.disabled=!0,o.value="",o.disabled=!0):(a.disabled=!1,t.disabled=!1,o.disabled=!1)}function setGeradorEstado(e){isRequestInProgress=e;let a=document.getElementById("botao-gerar-principal");a&&(a.disabled=e),document.querySelectorAll(".seletor-custom, #numeros-ancora").forEach(a=>{a&&(a.disabled=e)})}function renderizarJogos(e,a){if(!a)return;a.innerHTML="<h2>Boa sorte!</h2>";let t=["Janeiro","Fevereiro","Mar\xe7o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];e.forEach(e=>{let o=document.createElement("div");o.className="jogo";let r=document.createElement("div");if(r.className="numeros-container",e.trim().split(/\s+/).forEach(e=>{let a=document.createElement("span");a.className="numero",a.textContent=e,r.appendChild(a)}),"diadesorte"===loteriaAtual){let s=t[Math.floor(Math.random()*t.length)],n=document.createElement("span");n.textContent=`| M\xeas: ${s}`,n.style.cssText="font-weight:bold; margin-left:15px; font-size: 1.2rem;",r.appendChild(n)}let i=document.createElement("button");i.className="botao-copiar",i.innerHTML='<i class="fa-regular fa-copy"></i>',i.title="Copiar n\xfameros",i.onclick=function(){copiarNumeros(this)},o.appendChild(r),o.appendChild(i),a.appendChild(o)});let o=document.createElement("p");o.className="instrucao-aposta",o.textContent="Caso queira concorrer com os n\xfameros gerados no site, voc\xea precisa registra-lo em uma aposta oficial, em qualquer ag\xeancia lot\xe9rica ou no site de apostas da Caixa Econ\xf4mica Federal\xae, por sua conta e riscos. Boa sorte!",a.appendChild(o)}async function gerarPalpites(){if(isRequestInProgress)return;let e=document.getElementById("area-resultados"),a=document.getElementById("estrategia-select"),t=document.getElementById("dezenas-select"),o=document.getElementById("quantidade-select"),r=document.getElementById("numeros-ancora");if(!e||!a||!t||!o||!r)return;let s=a.value,n=t.value,i=o.value,l=r.value;setGeradorEstado(!0),e.innerHTML='<div class="spinner"></div>';try{let d="";d="montecarlo"===s?`/get-monte-carlo-game?loteria=${loteriaAtual}&ancora=${l}`:"sorteanalisadapremium"===s?`/get-sorte-analisada-premium-game?loteria=${loteriaAtual}`:`/get-games/${i}?loteria=${loteriaAtual}&estrategia=${s}&dezenas=${n}&ancora=${l}`;let c=await fetch(d);if(!c.ok)throw Error(`Erro na comunica\xe7\xe3o com o servidor: ${c.statusText}`);let u=await c.json();if(u.error)throw Error(`Erro no servidor: ${u.error}`);let m="montecarlo"===s||"sorteanalisadapremium"===s?[u.jogo]:u;renderizarJogos(m,e)}catch(g){console.error("Detalhes do erro:",g),e.innerHTML=`<p style="color: #ff8a80;">Falha na conex\xe3o. Por favor, tente novamente em alguns segundos.</p>`}finally{if("montecarlo"===s||"sorteanalisadapremium"===s){let p="sorteanalisadapremium"===s?20:10,f=document.getElementById("botao-gerar-principal");if(f){f.innerHTML=`Aguarde ${p}s...`;let h=setInterval(()=>{--p>0?f.innerHTML=`Aguarde ${p}s...`:(clearInterval(h),f.innerHTML="Gerar Palpites",setGeradorEstado(!1),handleEstrategiaChange())},1e3)}}else setGeradorEstado(!1),handleEstrategiaChange()}}async function exibirEstatisticas(){let e=document.querySelector("#estatisticas .botao-gerar");if(isRequestInProgress||!e||e.disabled)return;let a=document.getElementById("area-estatisticas");isRequestInProgress=!0,e.disabled=!0,e.innerHTML='<div class="spinner" style="width: 25px; height: 25px; margin: 0 auto;"></div> Carregando...';try{let[t,o]=await Promise.all([fetch(`/get-stats?loteria=${loteriaAtual}`),fetch(`/get-stats-recentes?loteria=${loteriaAtual}`)]);if(!t.ok)throw Error("Falha ao buscar dados gerais do servidor.");if(!o.ok)throw Error("Falha ao buscar dados recentes do servidor.");let r=await t.json(),s=await o.json();if(r.error||!r.frequencia||!r.stats_primos||!r.stats_pares)throw Error(r.error||"Os dados gerais recebidos s\xe3o inv\xe1lidos.");if(s.error||!s.frequencia_recente)throw Error(s.error||"Os dados recentes recebidos s\xe3o inv\xe1lidos.");let n=lotteryConfig[loteriaAtual].nome,i=document.getElementById("ultimo-concurso-info");i&&(i.innerHTML=`An\xe1lise da ${n}: at\xe9 o concurso ${r.ultimo_concurso}`),a&&(a.style.display="block"),[graficoMaisSorteados,graficoMenosSorteados,graficoPrimos,graficoParesImpares,graficoMaisSorteadosRecentes,graficoMenosSorteadosRecentes].forEach(e=>{e&&e.destroy()});let l="#FFFDE7",d={scales:{y:{ticks:{color:l},grid:{color:"rgba(255, 255, 255, 0.2)"}},x:{ticks:{color:l},grid:{color:"transparent"}}},plugins:{legend:{labels:{color:l},onClick:null}}},c=[...r.frequencia].sort((e,a)=>a.frequencia-e.frequencia).slice(0,10),u=document.getElementById("grafico-mais-sorteados");u&&(graficoMaisSorteados=new Chart(u.getContext("2d"),{type:"bar",data:{labels:c.map(e=>`N\xba ${e.numero}`),datasets:[{label:"Vezes Sorteado",data:c.map(e=>e.frequencia),backgroundColor:"#FFD700"}]},options:d}));let m=[...r.frequencia].sort((e,a)=>e.frequencia-a.frequencia).slice(0,10),g=document.getElementById("grafico-menos-sorteados");g&&(graficoMenosSorteados=new Chart(g.getContext("2d"),{type:"bar",data:{labels:m.map(e=>`N\xba ${e.numero}`),datasets:[{label:"Vezes Sorteado",data:m.map(e=>e.frequencia),backgroundColor:"#90CAF9"}]},options:d}));let p=Object.keys(r.stats_primos).sort((e,a)=>parseInt(e)-parseInt(a)).map(e=>`${e} Primos`),f=Object.keys(r.stats_primos).sort((e,a)=>parseInt(e)-parseInt(a)).map(e=>r.stats_primos[e]),h=document.getElementById("grafico-primos");h&&(graficoPrimos=new Chart(h.getContext("2d"),{type:"bar",data:{labels:p,datasets:[{label:"Sorteios",data:f,backgroundColor:"#81C784"}]},options:d}));let y=lotteryConfig[loteriaAtual].num_bolas,b=Object.keys(r.stats_pares).sort((e,a)=>parseInt(e)-parseInt(a)).map(e=>`${e} Pares / ${y-parseInt(e)} \xcdmpares`),v=Object.keys(r.stats_pares).sort((e,a)=>parseInt(e)-parseInt(a)).map(e=>r.stats_pares[e]),E=document.getElementById("grafico-pares-impares");E&&(graficoParesImpares=new Chart(E.getContext("2d"),{type:"bar",data:{labels:b,datasets:[{label:"Sorteios",data:v,backgroundColor:"#FF8A65"}]},options:d}));let k=[...s.frequencia_recente].sort((e,a)=>a.frequencia-e.frequencia).slice(0,10),C=document.getElementById("grafico-mais-sorteados-recentes");C&&(graficoMaisSorteadosRecentes=new Chart(C.getContext("2d"),{type:"bar",data:{labels:k.map(e=>`N\xba ${e.numero}`),datasets:[{label:"Vezes Sorteado (\xdaltimos 100)",data:k.map(e=>e.frequencia),backgroundColor:"#FFECB3"}]},options:d}));let w=[...s.frequencia_recente].sort((e,a)=>e.frequencia-a.frequencia).slice(0,10),$=document.getElementById("grafico-menos-sorteados-recentes");$&&(graficoMenosSorteadosRecentes=new Chart($.getContext("2d"),{type:"bar",data:{labels:w.map(e=>`N\xba ${e.numero}`),datasets:[{label:"Vezes Sorteado (\xdaltimos 100)",data:w.map(e=>e.frequencia),backgroundColor:"#BBDEFB"}]},options:d})),e&&(e.style.display="none")}catch(L){console.error("Erro ao carregar estat\xedsticas:",L),a&&(a.innerHTML=`<p style="color: #ff8a80;">${L.message}</p>`,a.style.display="block"),e&&(e.innerHTML="Estat\xedsticas",e.disabled=!1)}finally{isRequestInProgress=!1}}async function submitFeedback(e){let a=document.getElementById("feedback-area"),t=document.getElementById("feedback-message");if(a&&t)try{let o=await fetch("/submit-feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({choice:e})});if(!o.ok)throw Error("Falha ao enviar.");t.textContent="Obrigado pelo seu feedback!",t.style.color="#81C784",a.querySelectorAll("button").forEach(e=>e.disabled=!0)}catch(r){t.textContent="Erro ao enviar. Tente novamente.",t.style.color="#ff8a80"}}async function carregarUltimosResultados(e){if(carregandoResultados)return;carregandoResultados=!0;let a=document.getElementById("lista-ultimos-resultados");if(!a){carregandoResultados=!1;return}a.innerHTML='<div class="spinner"></div>';try{let t=await fetch(`/get-ultimos-resultados?loteria=${e}`);if(!t.ok)throw Error("Falha ao carregar os resultados.");let o=await t.json();if(o.error)throw Error(o.error);if(0===o.length){a.innerHTML="<p>Nenhum resultado encontrado para esta loteria.</p>";return}let r="";o.forEach(a=>{let t="";if(a.acumulou)t=`<span class="status-acumulou">ACUMULOU</span>${a.valor_acumulado?`<div class="valor-acumulado">Pr\xeamio estimado: R$ ${a.valor_acumulado.toLocaleString("pt-BR",{minimumFractionDigits:2})}</div>`:""}`;else{let o=a.ganhadores>1?"Ganhadores":"Ganhador";t=`<span class="status-ganhador">${a.ganhadores} ${o}</span>`}let s="";"diadesorte"===e&&a.mes_sorte&&(s=`<div class="resultado-mes">M\xeas da Sorte: <strong>${a.mes_sorte}</strong></div>`);let n="";if(a.data){if(a.data.includes("/")){let i=a.data.split("/");if(3===i.length){let l=parseInt(i[0]),d=parseInt(i[1]);n=l>12?a.data:d>12?`${i[1]}/${i[0]}/${i[2]}`:a.data}else n=a.data}else n=a.data}r+=`
                <div class="resultado-item">
                    <div class="resultado-header">
                        <span class="resultado-concurso">Concurso ${a.concurso}</span>
                        <span class="resultado-data">${n}</span>
                    </div>
                    <div class="resultado-dezenas">${a.dezenas}</div>
                    ${s}
                    <div class="resultado-status">${t}</div>
                </div>
            `}),a.innerHTML=r}catch(s){console.error("Erro ao carregar \xfaltimos resultados:",s),a.innerHTML=`<p style="color: #ff8a80;">N\xe3o foi poss\xedvel carregar os resultados. Tente novamente mais tarde.</p>`}finally{carregandoResultados=!1}}let artigosVisiveis=5;const totalArtigos=9;function carregarMaisArtigos(){let e=document.querySelectorAll(".artigo-blog:not(.visivel)"),a=Math.min(4,e.length);for(let t=0;t<a;t++)e[t].classList.add("visivel"),artigosVisiveis++;let o=document.getElementById("contador-artigos");o&&(o.textContent=`Mostrando ${artigosVisiveis} de 9 artigos`);let r=document.querySelector(".carregar-mais"),s=document.querySelector(".carregar-mais-container p");artigosVisiveis>=9&&(r&&(r.style.display="none"),s&&(s.innerHTML='<span style="color: var(--cor-sucesso);">âœ“ Todos os artigos carregados!</span>')),e.length>0&&e[0].scrollIntoView({behavior:"smooth",block:"center"})}function toggleArtigo(e){let a=document.getElementById(e);if(!a)return;let t=a.closest(".artigo-blog"),o=t.querySelector(".artigo-resumo"),r=t.querySelector(".fa-chevron-down, .fa-chevron-up");a.classList.contains("artigo-expandido")?(a.classList.remove("artigo-expandido"),o&&(o.style.display="block"),r&&(r.classList.remove("fa-chevron-up"),r.classList.add("fa-chevron-down"))):(a.classList.add("artigo-expandido"),o&&(o.style.display="none"),r&&(r.classList.remove("fa-chevron-down"),r.classList.add("fa-chevron-up")))}function compartilharWhatsApp(e,a){let t=encodeURIComponent(`${e} - ${a}`);window.open(`https://wa.me/?text=${t}`,"_blank")}function compartilharFacebook(e){window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(e)}`,"_blank")}function compartilharTwitter(e,a){let t=encodeURIComponent(`${e} ${a}`);window.open(`https://twitter.com/intent/tweet?text=${t}`,"_blank")}function compartilharThreads(e,a){let t=encodeURIComponent(`${e} ${a}`);window.open(`https://www.threads.net/intent/post?text=${t}`,"_blank")}function compartilharInstagram(){confirm("Para compartilhar no Instagram:\n\n1. Abra o Instagram\n2. Crie uma nova publica\xe7\xe3o ou story\n3. Marque @sorteanalisadaoficial\n4. Use a hashtag #SorteAnalisada\n\nDeseja abrir o Instagram?")&&window.open("https://www.instagram.com/","_blank")}function compartilharTikTok(){confirm("Para compartilhar no TikTok:\n\n1. Abra o TikTok\n2. Crie um v\xeddeo mencionando a Sorte Analisada\n3. Use a hashtag #SorteAnalisada\n4. Marque @sorte_analisada\n\nDeseja abrir o TikTok?")&&window.open("https://www.tiktok.com/","_blank")}function compartilharInstagramAmigavel(e,a){let t=encodeURIComponent(`Confira isso: ${e} - ${a}

@sorteanalisadaoficial #SorteAnalisada`);/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?(window.open(`instagram://library?AssetPath=${encodeURIComponent(a)}&Caption=${t}`,"_blank"),setTimeout(()=>{window.open("https://www.instagram.com/sorteanalisadaoficial/","_blank")},500)):window.open("https://www.instagram.com/sorteanalisadaoficial/","_blank")}function compartilharTikTokAmigavel(e,a){let t=encodeURIComponent(`${e} - ${a} #SorteAnalisada`);/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?(window.open(`tiktok://share?text=${t}`,"_blank"),setTimeout(()=>{window.open("https://www.tiktok.com/","_blank")},500)):window.open("https://www.tiktok.com/","_blank")}function copiarLink(e,a){navigator.clipboard.writeText(e).then(()=>{let e=a.target.closest(".share-btn");if(e){let t=e.innerHTML;e.innerHTML='<i class="fa-solid fa-check"></i> Copiado!',e.style.background="var(--cor-sucesso)",setTimeout(()=>{e.innerHTML=t,e.style.background="#6c757d"},2e3)}}).catch(a=>{console.error("Falha ao copiar:",a);let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy"),alert("Link copiado!")}catch(o){alert("Falha ao copiar. Por favor, copie manualmente: "+e)}document.body.removeChild(t)})}document.addEventListener("DOMContentLoaded",e=>{let a=document.getElementById("loteria-select");if(a){mudarLoteria(loteriaAtual=a.value),a.addEventListener("change",()=>mudarLoteria(a.value));let t=document.getElementById("loteria-select-resultados");t&&t.addEventListener("change",()=>mudarLoteriaResultados(t.value));let o=document.getElementById("estrategia-select");o&&o.addEventListener("change",handleEstrategiaChange);let r=document.getElementById("botao-gerar-principal");r&&r.addEventListener("click",gerarPalpites);let s=document.querySelector("#estatisticas .botao-gerar");s&&s.addEventListener("click",exibirEstatisticas)}let n=document.getElementById("contador-artigos");if(n){n.textContent=`Mostrando ${artigosVisiveis} de 9 artigos`;let i=document.querySelector(".carregar-mais");i&&i.addEventListener("click",carregarMaisArtigos),document.querySelectorAll(".artigo-blog").forEach((e,a)=>{a<artigosVisiveis&&e.classList.add("visivel")})}document.querySelectorAll(".share-btn.copy-link").forEach(e=>{e.addEventListener("click",a=>{e.dataset.url&&copiarLink(e.dataset.url,a)})})});