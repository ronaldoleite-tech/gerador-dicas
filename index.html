<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- ... (head sem alterações) ... -->
    <style>
        /* ... (style sem alterações) ... */
    </style>
</head>
<body onload="mudarLoteria('megasena')">

    <div class="container">

        <header>
            <img src="images/logotipo.png" alt="Logotipo Sorte Analisada" class="imagem-ouro" loading="lazy">
            <h1>Sorte Analisada</h1>
            <p class="subtitulo">Acredite na sua sorte!</p>
            <p id="loteria-selecionada" class="loteria-display"></p>
        </header>

        <main>
            <section class="secao-monte-carlo">
                <h2>Dica Especial: Simulação de Monte Carlo</h2>
                <div id="area-monte-carlo-resultado"></div>
                <button id="botao-monte-carlo" class="botao-gerar" onclick="gerarJogoMonteCarlo()" style="margin-top: 1rem;">Sugestão</button>
            </section>
            
            <section class="secao-controles">
                <div class="controle-item">
                    <label for="loteria-select">Loteria:</label>
                    <select id="loteria-select" class="seletor-custom" onchange="mudarLoteria(this.value)">
                        <option value="megasena">Mega-Sena</option>
                        <option value="quina">Quina</option>
                        <option value="lotofacil">Lotofácil</option>
                        <option value="diadesorte">Dia de Sorte</option>
                    </select>
                </div>
                <div class="controle-item">
                    <label for="dezenas-select">Dezenas:</label>
                    <select id="dezenas-select" class="seletor-custom"></select>
                </div>
                <!-- ALTERAÇÃO 2: CAMPO SIMPLIFICADO PARA NÚMERO ÚNICO -->
                <div class="controle-item">
                    <label for="numeros-ancora">Número da sorte:</label>
                    <input type="text" id="numeros-ancora" class="seletor-custom" placeholder="Ex: 7" 
                           style="width: 80px;" maxlength="2" pattern="\d*">
                </div>
                <div class="controle-item">
                    <label for="filtro-toggle">Filtros: OFF | ON</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="filtro-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </section>
            
            <section class="secao-botoes">
                <h2>Quantidade de dicas:</h2>
                <div class="grupo-botoes">
                    <button class="botao-gerar" onclick="gerarJogos(1)">01</button>
                    <button class="botao-gerar" onclick="gerarJogos(5)">05</button>
                    <button class="botao-gerar" onclick="gerarJogos(10)">10</button>
                </div>
            </section>

            <section id="area-resultados" aria-live="polite" aria-atomic="true"></section>
        </main>
        
        <nav class="nav-interna">
            <a href="#sobre">Sobre</a> <a href="#projeto">Projeto</a> <a href="#sobre-filtros">Filtros</a> <a href="#simulacao-monte-carlo-info">Simulação de Monte Carlo</a> <a href="#estatisticas">Estatísticas</a> <a href="#parceiros">Parceiros</a> <a href="#doacao">Apoie o Projeto</a> <a href="#termos">Termos de Uso</a>
        </nav>

        <div class="footer-content">
             <!-- ... (todas as seções do footer continuam aqui, sem alterações) ... -->
            <section id="sobre" class="footer-section">
                <h2>Sobre</h2>
                <p>O Sorte Analisada nasceu para ser seu parceiro na jornada da sorte, oferecendo uma plataforma completa para gerar palpites inteligentes para as Loterias. Use nossos filtros baseados em frequência histórica ou opte por uma "surpresinha" 100% aleatória. Nossas ferramentas são perfeitas para apostas individuais ou para organizar bolões com amigos. Lembre-se: jogos de loteria são destinados a <strong>maiores de 18 anos</strong>. Aposte com responsabilidade e que a sorte esteja ao seu lado!</p>
                <a href="#" class="voltar-topo">Voltar ao Topo &uarr;</a>
            </section>
            
            <section id="projeto" class="footer-section">
                <h2>Projeto Sorte Analisada</h2>
                <p>Existem vários sites e programas que geram números aleatórios, as próprias lotéricas tem esta opção, a surpresinha. A proposta deste projeto é dar uma alternativa robusta e moderna de geração de números aleatórios, para as principais loterias brasileiras. Ficarei imensamente feliz e grato caso este projeto, venha ajudar alguém a acertar as dezenas de alguma das loterias. Reforço que as sugestões geradas neste site, não mudam o caráter de jogos de azar e aleatórios das loterias, e o uso ou não dos números gerados, é de decisão pessoal do usuário. Este projeto não incentiva, não vende produto de loterias e não tem qualquer relação com as Loterias da Caixa Econômica Federal ou qualquer outra entidade lotérica. Jogos de loterias são produtos destinados a adultos e sempre jogue com responsabilidade. Para mais informação, consulte o Jogo Responsável da Caixa, programa promover o jogo seguro e consciente: <a href="https://www.caixa.gov.br/jogo-responsavel" target="_blank" style="color: var(--cor-dourado);">https://www.caixa.gov.br/jogo-responsavel</a>. Sou grato a todos que me incentivaram e apoiaram na elaboração deste trabalho, que possibilitou eu aprendesse muito com os erros e acertos para chegar até este ponto.<br><br>Abraço,<br>Ronaldo Leite</p>
                <a href="#" class="voltar-topo">Voltar ao Topo &uarr;</a>
            </section>

            <section id="sobre-filtros" class="footer-section">
                 <h2>Entenda Nossos Filtros</h2>
                <h3>Com o Filtro Ativado (ON)</h3>
                <p>Nosso sistema analisa todo o histórico de resultados da loteria selecionada. Os números que foram sorteados mais vezes no passado recebem um "peso" maior, aumentando a probabilidade de serem escolhidos para a sua sugestão. É a escolha ideal para quem acredita que alguns números têm mais tendência a aparecer.</p>
                <h3>Com o Filtro Desativado (OFF)</h3>
                <p>A geração é 100% aleatória. Cada número, dentro do universo da loteria escolhida, possui exatamente a mesma chance de ser incluído no seu jogo. Este método simula uma "surpresinha" pura, onde o histórico de sorteios é completamente ignorado. É perfeito para quem acredita que a sorte não tem memória.</p>
                <a href="#" class="voltar-topo">Voltar ao Topo &uarr;</a>
            </section>
            
            <section id="simulacao-monte-carlo-info" class="footer-section">
                <h2>O que é a Simulação de Monte Carlo?</h2>
                <p>É uma técnica computacional que simula milhares de sorteios aleatórios para identificar combinações de números que, estatisticamente, teriam alta probabilidade de aparecer. No nosso site, usamos essa simulação para oferecer uma "dica especial", um palpite único gerado a partir de uma análise de probabilidade avançada, ideal para quem busca uma aposta diferenciada.</p>
                <a href="#" class="voltar-topo">Voltar ao Topo &uarr;</a>
            </section>
            
            <section id="estatisticas" class="footer-section">
               <h2>Estatísticas dos Sorteios</h2>
               <p>Veja a frequência dos números sorteados e descubra quais dezenas saem mais. A análise é baseada em todos os concursos armazenados em nosso banco de dados.</p>
               <p style="text-align: center; margin: 1rem 0;"><strong id="ultimo-concurso-info">...</strong></p>
                <div class="grupo-botoes" style="margin-bottom: 2rem;">
                    <button class="botao-gerar" onclick="exibirEstatisticas()">Estatísticas</button>
                </div>
                <div id="area-estatisticas" style="display: none;">
                    <div><h3 style="color: white; margin-bottom: 1rem;">As 10 Dezenas Mais Sorteadas</h3><canvas id="grafico-mais-sorteados"></canvas></div>
                    <div style="margin-top: 2rem;"><h3 style="color: white; margin-bottom: 1rem;">As 10 Dezenas Menos Sorteadas</h3><canvas id="grafico-menos-sorteados"></canvas></div>
                    <div style="margin-top: 2rem;"><h3 style="color: white; margin-bottom: 1rem;">Frequência de Números Primos</h3><canvas id="grafico-primos"></canvas></div>
                    <div style="margin-top: 2rem;"><h3 style="color: white; margin-bottom: 1rem;">Distribuição de Pares e Ímpares</h3><canvas id="grafico-pares-impares"></canvas></div>
                </div>
                <a href="#" class="voltar-topo">Voltar ao Topo &uarr;</a>
            </section>

            <section id="parceiros" class="footer-section">
                <h2>Apoiadores que Fazem a Sorte Acontecer</h2>
                <p style="margin-bottom: 2rem; text-align: center; line-height: 1.8;">O Sorte Analisada cresce graças ao apoio de marcas que acreditam na nossa missão de levar entretenimento e análise de qualidade para apostadores de todo o Brasil. Agradecemos a confiança por fazerem parte desta jornada.</p>
                <div class="partner-ad-container">
                    <h3 class="partner-title">SISTEMAS IDEAL, AUTOMAÇÃO COMERCIAL</h3>
                    <img src="images/Ideal.jpg" alt="Logo da Sistemas Ideal Automação Comercial" class="partner-logo">
                    <p class="partner-text">Automação Comercial | Sat | Erp |<br>Pontos de Vendas em geral</p>
                    <a href="https://wa.me/5511962779427" class="partner-cta-button" target="_blank">
                        <i class="fa-brands fa-whatsapp"></i>
                        WhatsApp 11 96277-9427
                    </a>
                    <a href="https://linktr.ee/sistemas_ideal?fbclid=PAQ0xDSwMO5VJleHRuA2FlbQIxMQABp6bwYGcDvVxhsmmaSphrP4hglvs3Y4t4W-zZMB90tSkMbfImd7UJWwwFuyAZ_aem_FSR9c1Ytg3B8pgZkdqgkqw" class="partner-social-link" target="_blank">
                        <i class="fa-brands fa-instagram"></i>
                        <span>Siga-nos no Instagram</span>
                    </a>
                </div>
                <div style="margin-top: 2.5rem; padding: 1.5rem; background: rgba(0,0,0,0.2); border-radius: 12px;">
                    <h3 style="text-align: center; color: var(--cor-dourado);">Quer ver sua marca em destaque aqui?</h3>
                    <p style="margin-top: 1rem; margin-bottom: 1.5rem; text-align: center;">Conecte seu negócio a uma comunidade engajada que busca por sorte e novas oportunidades. Aumente sua visibilidade e apoie um projeto em constante crescimento.</p>
                    <a href="mailto:ronaldoleite@sorteanalisada.com.br?subject=Interesse em Parceria - Sorte Analisada" class="botao-gerar" style="text-decoration: none;">Anuncie</a>
                </div>
                <a href="#" class="voltar-topo">Voltar ao Topo &uarr;</a>
            </section>
            
            <section id="doacao" class="footer-section">
                <h2>Apoie o Projeto</h2>
                <p>Se nossos palpites e análises foram úteis para você, considere apoiar o projeto com uma doação via PIX. Sua contribuição é fundamental para que possamos continuar oferecendo esta ferramenta de forma gratuita.</p>
                <img src="images/placeholder-qrcode.png" alt="QR Code para doação via PIX" style="width: 180px; height: 180px; background-color: white; border: 4px solid var(--cor-dourado); border-radius: 10px; margin: 1rem auto; display: block;">
                <a href="#" class="voltar-topo">Voltar ao Topo &uarr;</a>
            </section>
            
            <section id="termos" class="footer-section">
                <h2>Termo de Uso</h2>
                <p>O site <strong>Sorte Analisada</strong> é uma ferramenta de entretenimento destinada a maiores de 18 anos. Geramos sugestões de números para jogos de loteria com base em algoritmos e dados históricos, mas <strong>não oferecemos nenhuma garantia de prêmios ou acertos</strong>. Os resultados das loterias são imprevisíveis e dependem exclusivamente da sorte. Este site não possui qualquer vínculo com a Caixa Econômica Federal ou qualquer outra entidade lotérica. Jogue com responsabilidade e por sua conta e risco.</p>
                <a href="#" class="voltar-topo">Voltar ao Topo &uarr;</a>
            </section>
        </div>

        <footer class="site-footer">
            <h4 class="footer-social-title">Siga a Sorte Analisada</h4> 
            <div class="footer-links">
                <a href="mailto:ronaldoleite@sorteanalisada.com.br" title="Contato"><i class="fa-solid fa-envelope"></i></a>
                <a href="https://www.instagram.com/ronaldo_leite_/?igsh=MTc0dGtud3c1amlpaQ%3D%3D#" title="Instagram" target="_blank"><i class="fa-brands fa-instagram"></i></a> 
                <a href="https://www.tiktok.com/@sorte_analisada?_t=ZM-8yxvja7YoS8&_r=1" title="TikTok" target="_blank"><i class="fa-brands fa-tiktok"></i></a>
            </div>
            <div class="copyright">
                © 2025 Sorte Analisada. Todos os direitos reservados.
            </div>
        </footer>
    </div>

    <script>
        // ... (todo o script JavaScript, incluindo as funções de fetch atualizadas, vai aqui) ...
        let loteriaAtual = 'megasena';
        const lotteryConfig = {
            'megasena':   {nome: 'Mega-Sena', min_dezenas: 6, max_dezenas: 20, num_bolas: 6},
            'quina':      {nome: 'Quina', min_dezenas: 5, max_dezenas: 15, num_bolas: 5},
            'lotofacil':  {nome: 'Lotofácil', min_dezenas: 15, max_dezenas: 20, num_bolas: 15},
            'diadesorte': {nome: 'Dia de Sorte', min_dezenas: 7, max_dezenas: 15, num_bolas: 7}
        };
        let graficoMaisSorteados = null, graficoMenosSorteados = null, graficoPrimos = null, graficoParesImpares = null;
        let isRequestInProgress = false;

        function mudarLoteria(novaLoteria) {
            loteriaAtual = novaLoteria;
            document.getElementById('loteria-select').value = novaLoteria;
            const config = lotteryConfig[loteriaAtual];
            const displayLoteria = document.getElementById('loteria-selecionada');
            displayLoteria.textContent = config.nome;
            displayLoteria.style.opacity = 1;
            document.getElementById('botao-monte-carlo').textContent = `Sugestão de ${config.num_bolas} dezenas`;
            atualizarOpcoesDezenas();
            document.getElementById('area-resultados').innerHTML = '';
            document.getElementById('area-monte-carlo-resultado').innerHTML = '';
            document.getElementById('area-estatisticas').style.display = 'none';
            const botaoStats = document.querySelector('#estatisticas .botao-gerar');
            if (botaoStats) {
                botaoStats.style.display = 'block';
                botaoStats.disabled = false;
                botaoStats.innerHTML = 'Estatísticas';
            }
        }

        function atualizarOpcoesDezenas() {
            const select = document.getElementById('dezenas-select');
            const config = lotteryConfig[loteriaAtual];
            select.innerHTML = '';
            for (let i = config.min_dezenas; i <= config.max_dezenas; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i} Dezenas`;
                select.appendChild(option);
            }
        }
        
        function setBotoesEstado(desabilitar) {
            isRequestInProgress = desabilitar;
            document.querySelectorAll('.secao-botoes .botao-gerar, #estatisticas .botao-gerar').forEach(btn => btn.disabled = desabilitar);
        }

        async function gerarJogoMonteCarlo() {
            const botaoMonteCarlo = document.getElementById('botao-monte-carlo');
            if (botaoMonteCarlo.disabled) return;

            const areaResultado = document.getElementById('area-monte-carlo-resultado');
            const numerosAncora = document.getElementById('numeros-ancora').value;
            botaoMonteCarlo.disabled = true;
            areaResultado.innerHTML = '<div class="spinner"></div>';
            
            try {
                const response = await fetch(`/get-monte-carlo-game?loteria=${loteriaAtual}&ancora=${numerosAncora}`);
                if (!response.ok) throw new Error('Falha na comunicação com o servidor.');
                const data = await response.json();
                
                areaResultado.innerHTML = '';
                const jogoContainer = document.createElement('div');
                jogoContainer.className = 'jogo';
                data.jogo.trim().split(/\s+/).forEach(num => {
                    const span = document.createElement('span');
                    span.className = 'numero';
                    span.textContent = num;
                    jogoContainer.appendChild(span);
                });

                if (loteriaAtual === 'diadesorte') {
                    const meses = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
                    const mesSorteado = meses[Math.floor(Math.random() * meses.length)];
                    const spanMes = document.createElement('span');
                    spanMes.textContent = `| Mês: ${mesSorteado}`;
                    spanMes.style.cssText = 'font-weight:bold; margin-left:15px; font-size: 1.2rem;';
                    jogoContainer.appendChild(spanMes);
                }
                areaResultado.appendChild(jogoContainer);

            } catch (error) {
                areaResultado.innerHTML = `<p style="color: #ff8a80;">${error.message}</p>`;
            } finally {
                let segundosRestantes = 15;
                botaoMonteCarlo.textContent = `Aguarde ${segundosRestantes}s...`;
                const intervalId = setInterval(() => {
                    segundosRestantes--;
                    botaoMonteCarlo.textContent = `Aguarde ${segundosRestantes}s...`;
                    if (segundosRestantes <= 0) {
                        clearInterval(intervalId);
                        botaoMonteCarlo.disabled = false;
                        const config = lotteryConfig[loteriaAtual];
                        botaoMonteCarlo.textContent = `Sugestão de ${config.num_bolas} dezenas`;
                    }
                }, 1000);
            }
        }

        async function gerarJogos(quantidade) {
            if (isRequestInProgress) return;
            const areaResultados = document.getElementById('area-resultados');
            const filtroAtivado = document.getElementById('filtro-toggle').checked;
            const dezenas = document.getElementById('dezenas-select').value;
            const numerosAncora = document.getElementById('numeros-ancora').value;
            setBotoesEstado(true);
            areaResultados.innerHTML = '<div class="spinner"></div>';
            
            try {
                const response = await fetch(`/get-games/${quantidade}?loteria=${loteriaAtual}&filtro=${filtroAtivado}&dezenas=${dezenas}&ancora=${numerosAncora}`);
                if (!response.ok) throw new Error('Falha na comunicação com o servidor.');
                const jogos = await response.json();

                areaResultados.innerHTML = '<h2>Boa sorte!</h2>';
                const meses = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];

                jogos.forEach(linha => {
                    const jogoContainer = document.createElement('div');
                    jogoContainer.className = 'jogo';
                    linha.trim().split(/\s+/).forEach(num => {
                        const span = document.createElement('span');
                        span.className = 'numero';
                        span.textContent = num;
                        jogoContainer.appendChild(span);
                    });

                    if (loteriaAtual === 'diadesorte') {
                        const mesSorteado = meses[Math.floor(Math.random() * meses.length)];
                        const spanMes = document.createElement('span');
                        spanMes.textContent = `| Mês: ${mesSorteado}`;
                        spanMes.style.cssText = 'font-weight:bold; margin-left:15px; font-size: 1.2rem;';
                        jogoContainer.appendChild(spanMes);
                    }
                    areaResultados.appendChild(jogoContainer);
                });

            } catch (error) {
                areaResultados.innerHTML = `<p style="color: #ff8a80;">${error.message}</p>`;
            } finally {
                setBotoesEstado(false);
            }
        }

        async function exibirEstatisticas() {
            if (isRequestInProgress) return;
            const areaStats = document.getElementById('area-estatisticas');
            const botao = document.querySelector('#estatisticas .botao-gerar');
            
            setBotoesEstado(true);
            botao.innerHTML = '<div class="spinner" style="width:20px; height:20px; border-width:3px; margin:0 auto;"></div>';
            
            try {
                const response = await fetch(`/get-stats?loteria=${loteriaAtual}`);
                if (!response.ok) throw new Error('Falha ao buscar dados do servidor.');
                const data = await response.json();
                if (!data || !data.frequencia || !data.stats_primos || !data.stats_pares) throw new Error('Os dados recebidos são inválidos.');

                const nomeLoteria = lotteryConfig[loteriaAtual].nome;
                document.getElementById('ultimo-concurso-info').innerHTML = `Análise da ${nomeLoteria} baseada até o concurso ${data.ultimo_concurso}`;
                areaStats.style.display = 'block';

                [graficoMaisSorteados, graficoMenosSorteados, graficoPrimos, graficoParesImpares].forEach(g => { if(g) g.destroy(); });

                const corTexto = '#FFFDE7', corGrid = 'rgba(255, 255, 255, 0.2)';
                
                const chartOptions = { 
                    scales: { 
                        y: { ticks: { color: corTexto }, grid: { color: corGrid } }, 
                        x: { ticks: { color: corTexto }, grid: { color: 'transparent' } } 
                    }, 
                    plugins: { 
                        legend: { 
                            labels: { color: corTexto },
                            onClick: null
                        } 
                    } 
                };

                const maisSorteados = [...data.frequencia].sort((a, b) => b.frequencia - a.frequencia).slice(0, 10);
                graficoMaisSorteados = new Chart(document.getElementById('grafico-mais-sorteados').getContext('2d'), { type: 'bar', data: { labels: maisSorteados.map(i => `Nº ${i.numero}`), datasets: [{ label: 'Vezes Sorteado', data: maisSorteados.map(i => i.frequencia), backgroundColor: '#FFD700' }] }, options: chartOptions });
                
                const menosSorteados = [...data.frequencia].sort((a, b) => a.frequencia - b.frequencia).slice(0, 10);
                graficoMenosSorteados = new Chart(document.getElementById('grafico-menos-sorteados').getContext('2d'), { type: 'bar', data: { labels: menosSorteados.map(i => `Nº ${i.numero}`), datasets: [{ label: 'Vezes Sorteado', data: menosSorteados.map(i => i.frequencia), backgroundColor: '#90CAF9' }] }, options: chartOptions });
                
                const labelsPrimos = Object.keys(data.stats_primos).sort((a,b) => parseInt(a)-parseInt(b)).map(k => `${k} Primos`);
                const dataPrimos = Object.keys(data.stats_primos).sort((a,b) => parseInt(a)-parseInt(b)).map(k => data.stats_primos[k]);
                graficoPrimos = new Chart(document.getElementById('grafico-primos').getContext('2d'), { type: 'bar', data: { labels: labelsPrimos, datasets: [{ label: 'Sorteios', data: dataPrimos, backgroundColor: '#81C784' }] }, options: chartOptions });
                
                const numBolas = lotteryConfig[loteriaAtual].num_bolas;
                const labelsPares = Object.keys(data.stats_pares).sort((a,b) => parseInt(a)-parseInt(b)).map(k => `${k} Pares / ${numBolas - parseInt(k)} Ímpares`);
                const dataPares = Object.keys(data.stats_pares).sort((a,b) => parseInt(a)-parseInt(b)).map(k => data.stats_pares[k]);
                graficoParesImpares = new Chart(document.getElementById('grafico-pares-impares').getContext('2d'), { type: 'bar', data: { labels: labelsPares, datasets: [{ label: 'Sorteios', data: dataPares, backgroundColor: '#FF8A65' }] }, options: chartOptions });
                
                botao.style.display = 'none';

            } catch (error) {
                areaStats.innerHTML = `<p style="color: #ff8a80;">${error.message}</p>`;
                areaStats.style.display = 'block';
                botao.innerHTML = 'Estatísticas';
            } finally {
                setBotoesEstado(false);
            }
        }
    </script>
</body>
</html>